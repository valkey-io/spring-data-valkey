{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/resp-bench/schemas/workload-config.schema.json",
  "title": "Workload Configuration",
  "description": "Configuration for a benchmark workload in resp-bench",
  "type": "object",
  "required": ["schema_version", "benchmark_profile", "phases"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema version for compatibility checking",
      "enum": ["1.0"]
    },
    "benchmark_profile": {
      "type": "object",
      "description": "Metadata about this benchmark profile",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the benchmark profile"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of what this benchmark measures"
        },
        "version": {
          "type": "string",
          "description": "Version of this benchmark profile"
        }
      }
    },
    "phases": {
      "type": "array",
      "description": "List of benchmark phases to execute in order",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/phase"
      }
    }
  },
  "definitions": {
    "phase": {
      "type": "object",
      "required": ["id", "connections", "completion", "keyspace", "commands"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this phase (appears in metrics output)"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this phase"
        },
        "connections": {
          "type": "integer",
          "description": "Number of client connections to use",
          "minimum": 1
        },
        "cps_limit": {
          "type": "integer",
          "description": "Connection rate limit per second (-1 = unlimited)",
          "default": -1
        },
        "rps_limit": {
          "type": "integer",
          "description": "Request rate limit per second (-1 = unlimited)",
          "default": -1
        },
        "pipeline_depth": {
          "type": "integer",
          "description": "Maximum in-flight requests per connection",
          "minimum": 1,
          "default": 1
        },
        "warmup_requests": {
          "type": "integer",
          "description": "Number of warmup PING requests per client (0 to disable)",
          "minimum": 0,
          "default": 1
        },
        "completion": {
          "$ref": "#/definitions/completion"
        },
        "keyspace": {
          "$ref": "#/definitions/keyspace"
        },
        "commands": {
          "type": "array",
          "description": "Commands to execute with their weights",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/command"
          }
        }
      }
    },
    "completion": {
      "type": "object",
      "description": "Phase completion criteria",
      "required": ["type"],
      "oneOf": [
        {
          "properties": {
            "type": { "const": "duration" },
            "seconds": {
              "type": "integer",
              "description": "Duration in seconds",
              "minimum": 1
            }
          },
          "required": ["type", "seconds"]
        },
        {
          "properties": {
            "type": { "const": "requests" },
            "requests": {
              "type": "integer",
              "description": "Total number of requests to complete",
              "minimum": 1
            }
          },
          "required": ["type", "requests"]
        }
      ]
    },
    "keyspace": {
      "type": "object",
      "description": "Key generation configuration",
      "required": ["keys_count", "key_prefix", "generation_alg"],
      "properties": {
        "keys_count": {
          "type": "integer",
          "description": "Total number of unique keys in the keyspace",
          "minimum": 1
        },
        "key_size_bytes": {
          "type": "integer",
          "description": "Target key size in bytes (excluding prefix)",
          "minimum": 1,
          "default": 16
        },
        "key_prefix": {
          "type": "string",
          "description": "Prefix for all generated keys"
        },
        "generation_alg": {
          "type": "string",
          "description": "Key generation algorithm",
          "enum": ["sequential_int", "uniform_rand"]
        },
        "seed": {
          "type": "integer",
          "description": "Random seed for reproducibility (required for uniform_rand)"
        }
      }
    },
    "command": {
      "type": "object",
      "description": "Command configuration",
      "required": ["command", "weight"],
      "properties": {
        "command": {
          "type": "string",
          "description": "Command name",
          "enum": [
            "get",
            "set",
            "ping",
            "hget",
            "hset",
            "lpush",
            "lpop",
            "sadd",
            "smembers"
          ]
        },
        "weight": {
          "type": "number",
          "description": "Relative weight for command selection (0.0-1.0)",
          "minimum": 0,
          "maximum": 1
        },
        "data_size_bytes": {
          "type": "integer",
          "description": "Size of value data in bytes (for write commands)",
          "minimum": 1
        }
      }
    }
  },
  "additionalProperties": false
}
